apiVersion: pingcap.com/v1alpha1
kind: TidbCluster
metadata:
  name: advanced-tidb
spec:
  version: "v5.4.0"
  timezone: UTC
  configUpdateStrategy: RollingUpdate
  helper:
    image: busybox:1.34.1
  pvReclaimPolicy: Retain
 
  enableDynamicConfiguration: true
  # pump:
  #   baseImage: pingcap/tidb-binlog
  #   version: v5.4.1
  #   requests:
  #     storage: 1Gi
  #   replicas: 1
  # tiflash:
  #   baseImage: pingcap/tiflash
  #   replicas: 2
  #   storageClaims:
  #     - resources:
  #         requests:
  #           storage: 1Gi
  #   # storageClaims: []
  #   configUpdateStrategy: RollingUpdate
  # ticdc:
  #   baseImage: pingcap/ticdc
  #   version: "v5.4.1"
  #   # requests:
  #   #   storage: 1Gi
  #   replicas: 1
  pd:
    baseImage: pingcap/pd
    config: |
      [dashboard]
        internal-proxy = true
    replicas: 3
    maxFailoverCount: 0
    requests:
      storage: 10Gi
    mountClusterClientSecret: true
    # dataSubDir: xtpxnorqpf
    # service:
    #   annotations:
    #     emowrglwba: fohobpdwcl
  # services:
  # - name: uytjmpivol
  tidb:
    baseImage: pingcap/tidb
    config: |
      [performance]
        tcp-keep-alive = true
    replicas: 3
    maxFailoverCount: 0
    service:
      # clusterIP: ofswknfqxr
      type: NodePort
      externalTrafficPolicy: Local
    plugins: null
    # annotations:
    #   dbquixhddr: klsdfjkjlf
  tikv:
    baseImage: pingcap/tikv
    config: |
      log-level = "info"
    replicas: 3
    maxFailoverCount: 0
    requests:
      storage: 100Gi
    mountClusterClientSecret: true
  # cluster:
  #   clusterDomain: asdasd # this is a bug of tidb
  #   name: obsakkicls # this is a bug of tidb
  #   namespace: zmmwzofdbq # this is a bug of tidb
  # discovery:
  #   configUpdateStrategy: RollingUpdate # this is a bug of tidb
